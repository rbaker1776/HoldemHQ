<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hold'em HQ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="../../static/styles.css" rel="stylesheet">
</head>
<body>
    <header class="hero container">
        <span class="brand" aria-label="Holdem HQ">
            <span class="chip" aria-hidden="true"></span>
            Hold'em HQ
        </span>
        <p class="subtitle">Spin up a Texas Hold'em room in seconds. Invite friends, deal the cards, go all-in.</p>
    </header>

    <main class="table-wrap">
        <section class="table-cloth" aria-label="Poker table">
            <div class="table-glow"></div>

            <div class="cards" aria-hidden="true">
                <div class="card-png c1">
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img></div>
                    </div>
                </div>
                <div class="card-png c2">
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img></div>
                    </div>
                </div>
                <div class="card-png c3">
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img></div>
                    </div>
                </div>
                <div class="card-png c4">
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img></div>
                    </div>
                </div>
                <div class="card-png c5">
                    <div class="card-inner">
                        <div class="card-front"></div>
                        <div class="card-back"><img></div>
                    </div>
                </div>
            </div>
        </section>

        <div class="panel p-3 p-md-4">
            <div class="row g-3 align-items-center">
                <div class="col-12 col-lg-5 text-center text-lg-start px-3">
                    <h2 class="h4 m-0">Start or Join a Room</h2>
                    <p class="small m-0">Public or private — your call.</p>
                </div>
                <div class="col-12 col-lg d-flex justify-content-center justify-content-lg-end gap-3 flex-wrap px-3">
                    <button class="btn btn-create btn-lg" data-bs-toggle="modal" data-bs-target="#createModal" aria-haspopup="dialog" aria-controls="createModal" aria-label="Create a new poker room">
                        <span class="me-1">♠</span> Create Room
                    </button>
                    <button class="btn btn-join btn-lg" data-bs-toggle="modal" data-bs-target="#joinModal" aria-haspopup="dialog" aria-controls="joinModal" aria-label="Join an existing room">
                        <span class="me-1">♦</span> Join Room
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="createLabel">Create a Room</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="" class="modal-body pt-0">
                    <div class="mb-3">
                        <label for="nickname" class="form-label">Your Nickname</label>
                        <input id="nickname" name="nickname" type="text" class="form-control" placeholder="Your table name" required />
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-create">Create Room</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="joinModal" tabindex="-1" aria-labelledby="joinLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="joinLabel">Join a Room</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="" class="modal-body pt-0">
                    <div class="mb-3">
                        <label for="roomId" class="form-label">Room Code</label>
                        <input id="roomId" name="room_id" type="text" class="form-control" placeholder="e.g. 7F3K9Q" required />
                    </div>
                    <div class="mb-3">
                        <label for="nickname" class="form-label">Nickname <span class="small">(optional)</span></label>
                        <input id="nickname" name="nickname" type="text" class="form-control" placeholder="Your table name" />
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-create">Join Room</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const SUITS = ['c','d','h','s']; // clubs, diamonds, hearts, spades
            const RANKS = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const SUIT_NAMES = {c:'Clubs', d:'Diamonds', h:'Hearts', s:'Spades'};

            const DECK = [];
            RANKS.forEach(r => { SUITS.forEach(s => {
                const fname = `${r}${s}.png`;
                const alt = `${rankName(r)} of ${SUIT_NAMES[s]}`;
                DECK.push({file: fname, alt});
            }); });

            function drawHand() {
                const deck = [...DECK];
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                return deck.slice(0,5);
            }

            function rankName(r) {
                switch (r) {
                    case 'A': return 'Ace';
                    case 'K': return 'King';
                    case 'Q': return 'Queen';
                    case 'J': return 'Jack';
                    default: return r;
                }
            }

            function assignCards(hand) {
                cardEls.forEach((c,i) => {
                    const img = c.querySelector('.card-back img');
                    img.src = `../../static/cards/${hand[i].file}`;
                    img.alt = hand[i].alt;
                });
            }

            function dealSequential() {
                inners.forEach((el, i) => {
                    setTimeout(() => el.classList.add('flipped'), i * STAGGER);
                });
            }

            function clearAllThenRedeal() {
                if (clearing) return;
                clearing = true;
                cardEls.forEach(c => c.classList.add('clearing'));
                setTimeout(() => {
                    cardEls.forEach(c => c.classList.remove('clearing'));
                    inners.forEach(el => el.classList.remove('flipped'));
                    const hand = drawHand();
                    assignCards(hand);
                    requestAnimationFrame(() => requestAnimationFrame(dealSequential));
                }, CLEAR_MS);
                const lastFlipEnds = STAGGER * (inners.length - 1) + FLIP_MS;
                setTimeout(() => clearAllThenRedeal(), SHOW_MS + lastFlipEnds);
                clearing = false;
            }

            function startLoop() {
                const hand = drawHand();
                assignCards(hand);
                dealSequential();
                const lastFlipEnds = STAGGER * (inners.length - 1) + FLIP_MS;
                setTimeout(() => clearAllThenRedeal(), SHOW_MS + lastFlipEnds);
            }
                                         // timings
            const STAGGER  = 250;        // ms between flips
            const FLIP_MS  = 600;        // transition duration
            const SHOW_MS  = 10000;      // how long cards remain shown
            const CLEAR_MS = 800;        // clear animation duration
            const CYCLE_MS = SHOW_MS + CLEAR_MS;

            const cardEls = Array.from(document.querySelectorAll('.card-png'));
            const inners  = cardEls.map(c => c.querySelector('.card-inner'));
            let clearing  = false;

            const displayInput = document.getElementById("chipstackDisplay");
            const hiddenInput = document.getElementById("chipstack");

            function formatCents(cents) {
                return `$${(cents / 100).toFixed(2)}`;
            }

            function updateFormat() {
                // remove non-digits
                let digits = displayInput.value.replace(/\D/g, "");
                if (digits === "") digits = "0";

                // always keep last two digits as cents
                const cents = parseInt(digits, 10);
                hiddenInput.value = cents;

                displayInput.value = formatCents(cents);
            }

            if (displayInput && hiddenInput) {
                displayInput.addEventListener("input", updateFormat);
                updateFormat(); // initialize on load
            }

            startLoop();
        });
    </script>
</body>
</html>
